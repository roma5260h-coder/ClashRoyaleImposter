# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
pythonClashBot/
‚îú‚îÄ‚îÄ main.py                          # ‚≠ê –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ settings.py                  # üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–∫–µ–Ω, –ø—É—Ç–∏, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã)
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ cards.json                   # üó∫Ô∏è –î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç Clash Royale (78 –∫–∞—Ä—Ç)
‚îÇ
‚îú‚îÄ‚îÄ game/                            # üéÆ –Ø–¥—Ä–æ –∏–≥—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ models.py                    # üì¶ –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Player, Game, Role, Card)
‚îÇ   ‚îú‚îÄ‚îÄ game_manager.py              # üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ role_distributor.py          # üé≤ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ card_loader.py               # üìñ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤—ã–±–æ—Ä –∫–∞—Ä—Ç
‚îÇ
‚îú‚îÄ‚îÄ handlers/                        # üîò –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Telegram
‚îÇ   ‚îú‚îÄ‚îÄ start_handler.py             # /start –∫–æ–º–∞–Ω–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ game_mode_handler.py         # –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ game_handler.py              # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã
‚îÇ
‚îú‚îÄ‚îÄ keyboards/
‚îÇ   ‚îî‚îÄ‚îÄ inline_keyboards.py          # ‚å®Ô∏è  –ò–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ –¥–ª—è UI
‚îÇ
‚îú‚îÄ‚îÄ storage/                         # üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ game_storage.py              # –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ logger.py                    # üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt                 # üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ .env.example                     # üîê –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore                       # ‚õî –§–∞–π–ª—ã, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –≤ Git
‚îú‚îÄ‚îÄ start.sh                         # üöÄ –°–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
‚îú‚îÄ‚îÄ README.md                        # üìñ –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ TOKEN_SETUP.md                   # üîê –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–æ–∫–µ–Ω—É
‚îú‚îÄ‚îÄ EXTENDING.md                     # üìö –ì–∞–π–¥ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
‚îú‚îÄ‚îÄ EXAMPLES.md                      # üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
‚îî‚îÄ‚îÄ ARCHITECTURE.md                  # üèóÔ∏è –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üîÑ Flow –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  main.py    ‚îÇ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Application
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ                 ‚îÇ                  ‚îÇ                ‚îÇ
   /start –∫–æ–º–∞–Ω–¥–∞   Callback handlers  CallbackQuery      Etc.
       ‚îÇ                 ‚îÇ                  ‚îÇ
       ‚ñº                 ‚ñº                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Telegram Bot API (python-telegram-bot)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Role (Enum)
```python
class Role(Enum):
    SPY = "spy"           # –®–ø–∏–æ–Ω (–Ω–µ –∑–Ω–∞–µ—Ç –∫–∞—Ä—Ç—É)
    CITIZEN = "citizen"   # –ì—Ä–∞–∂–¥–∞–Ω–∏–Ω (–∑–Ω–∞–µ—Ç –∫–∞—Ä—Ç—É)
```

### GameMode (Enum)
```python
class GameMode(Enum):
    STANDARD = "standard"  # 1 —à–ø–∏–æ–Ω, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–Ω–∞—é—Ç –∫–∞—Ä—Ç—É
```

### Player (DataClass)
```python
@dataclass
class Player:
    player_id: int                # –ù–æ–º–µ—Ä –≤ –∏–≥—Ä–µ (1, 2, 3...)
    telegram_id: int             # Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    role: Optional[Role] = None   # –†–æ–ª—å (–Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–≥—Ä—ã)
    username: Optional[str] = None
```

### Card (DataClass)
```python
@dataclass
class Card:
    id: str              # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (e.g., "barbarians")
    name_ru: str        # –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
    image_url: str      # URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ Supercell
```

### Game (DataClass)
```python
@dataclass
class Game:
    game_id: int                         # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
    chat_id: int                         # ID —á–∞—Ç–∞ Telegram
    creator_id: int                      # ID —Å–æ–∑–¥–∞—Ç–µ–ª—è –∏–≥—Ä—ã
    mode: GameMode                       # –†–µ–∂–∏–º (STANDARD)
    players: List[Player]                # –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
    card: Optional[Card] = None          # –í—ã–±—Ä–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞
    status: str = "waiting"              # –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã
    
    # –ú–µ—Ç–æ–¥—ã:
    def get_spy() -> Optional[Player]    # –ü–æ–ª—É—á–∏—Ç—å —à–ø–∏–æ–Ω–∞
    def get_citizen_count() -> int       # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä–∞–∂–¥–∞–Ω
    def get_start_player() -> Optional[Player]  # –ü–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫
```

### UserSession (DataClass)
```python
@dataclass
class UserSession:
    user_id: int                    # Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    game_id: Optional[int] = None   # ID —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã
    selected_mode: Optional[GameMode] = None
    selected_player_count: Optional[int] = None
    is_creator: bool = False        # –°–æ–∑–¥–∞—Ç–µ–ª—å –ª–∏ –∏–≥—Ä—ã?
```

---

## üéÆ –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å: game/

### CardLoader
```python
class CardLoader:
    """–ó–∞–≥—Ä—É–∑—á–∏–∫ –∫–∞—Ä—Ç —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    
    @classmethod
    def load_cards() -> List[Card]        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –∫–∞—Ä—Ç—ã (—Å –∫—ç—à–µ–º)
    
    @classmethod
    def get_random_card() -> Card         # –ü–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—É—é –∫–∞—Ä—Ç—É
    
    @classmethod
    def get_card_count() -> int           # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ä—Ç
```

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –í `game_handler.py` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–≥—Ä—ã
- –ö—ç—à–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—ã –≤ –ø–∞–º—è—Ç–∏ (–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑)

### RoleDistributor
```python
class RoleDistributor:
    """–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏"""
    
    @staticmethod
    def distribute_roles(
        players: List[Player],
        game_mode: GameMode
    ) -> List[Player]
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
        # –î–ª—è STANDARD: 1 —à–ø–∏–æ–Ω (—Å–ª—É—á–∞–π–Ω—ã–π), –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≥—Ä–∞–∂–¥–∞–Ω–µ
    
    @staticmethod
    def get_role_message(role: Role) -> str
        # "üïµÔ∏è –¢—ã —à–ø–∏–æ–Ω!" –∏–ª–∏ "üë§ –¢—ã –æ–±—ã—á–Ω—ã–π –∏–≥—Ä–æ–∫"
```

### GameManager
```python
class GameManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π (–≥–ª–æ–±–∞–ª—å–Ω—ã–π)"""
    
    def create_game(
        chat_id: int,
        creator_id: int,
        mode: GameMode,
        player_count: int
    ) -> Game
        # –°–æ–∑–¥–∞—ë—Ç –∏–≥—Ä—É —Å –ø—É—Å—Ç—ã–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏
    
    def get_game(game_id: int) -> Game
        # –ü–æ–ª—É—á–∏—Ç—å –∏–≥—Ä—É –ø–æ ID
    
    def assign_roles_and_card(game: Game) -> None
        # –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–æ–ª–∏ –∏ –≤—ã–±—Ä–∞—Ç—å –∫–∞—Ä—Ç—É
    
    def delete_game(game_id: int) -> None
        # –£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

**–ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä:**
```python
game_manager = GameManager()  # –î–æ—Å—Ç—É–ø–µ–Ω –≤–µ–∑–¥–µ
```

---

## üîò –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: handlers/

### start_handler.py
```python
async def start_command(update, context)
    # –ö–æ–º–∞–Ω–¥–∞: /start
    # –î–µ–π—Å—Ç–≤–∏–µ: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
```

**Flow:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É"

### game_mode_handler.py
```python
async def game_mode_callback(update, context)
    # Callback: "start_game"
    # –î–µ–π—Å—Ç–≤–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
    
async def mode_standard_callback(update, context)
    # Callback: "mode_standard"
    # –î–µ–π—Å—Ç–≤–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
```

**Flow:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
2. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º"
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º"
4. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "–í—ã–±–µ—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (3-10)"

### game_handler.py
```python
async def player_count_callback(update, context)
    # Callback: "players_N" (–≥–¥–µ N = 3-10)
    # –î–µ–π—Å—Ç–≤–∏–µ:
    #   1. –°–æ–∑–¥–∞—ë—Ç –∏–≥—Ä—É
    #   2. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª–∏
    #   3. –í—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ä—Ç—É
    #   4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    #   5. –û–±—ä—è–≤–ª—è–µ—Ç –≤ —á–∞—Ç–µ, –∫—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç

async def send_private_messages(game, context)
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
    # - –®–ø–∏–æ–Ω—É: "üïµÔ∏è –¢—ã —à–ø–∏–æ–Ω!"
    # - –ì—Ä–∞–∂–¥–∞–Ω–∞–º: "üó∫Ô∏è –ö–∞—Ä—Ç–∞: [–Ω–∞–∑–≤–∞–Ω–∏–µ]" + —Ñ–æ—Ç–æ
```

**Flow:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4)
2. –ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç –∏–≥—Ä—É —Å 4 –∏–≥—Ä–æ–∫–∞–º–∏
3. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç 1 —à–ø–∏–æ–Ω–∞, 3 –≥—Ä–∞–∂–¥–∞–Ω
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. –û–±—ä—è–≤–ª—è–µ—Ç –≤ —á–∞—Ç–µ: "–ò–≥—Ä—É –Ω–∞—á–∏–Ω–∞–µ—Ç: –ò–≥—Ä–æ–∫ 2"

---

## üíæ –•—Ä–∞–Ω–∏–ª–∏—â–µ: storage/

### GameStorage
```python
class GameStorage:
    """–•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π (–≤ –ø–∞–º—è—Ç–∏)"""
    
    def get_session(user_id: int) -> UserSession
        # –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Å—Å–∏—é (—Å–æ–∑–¥–∞—ë—Ç, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
    
    def create_session(user_id: int) -> UserSession
        # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
    
    def delete_session(user_id: int) -> None
        # –£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç, –∫–∞–∫–æ–π —Ä–µ–∂–∏–º –≤—ã–±—Ä–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –≤—ã–±—Ä–∞–ª
- –°–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –µ–≥–æ –∏–≥—Ä–æ–π

---

## ‚å®Ô∏è UI: keyboards/

### inline_keyboards.py
```python
def start_keyboard() -> InlineKeyboardMarkup
    # –ö–Ω–æ–ø–∫–∞: "üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É"

def game_mode_keyboard() -> InlineKeyboardMarkup
    # –ö–Ω–æ–ø–∫–∞: "üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º"

def player_count_keyboard() -> InlineKeyboardMarkup
    # –ö–Ω–æ–ø–∫–∏: "3 –∏–≥—Ä–æ–∫–æ–≤", "4 –∏–≥—Ä–æ–∫–æ–≤", ..., "10 –∏–≥—Ä–æ–∫–æ–≤"

def confirm_keyboard() -> InlineKeyboardMarkup
    # –ö–Ω–æ–ø–∫–∏: "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", "‚ùå –û—Ç–º–µ–Ω–∞"
```

---

## üîê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: config/

### settings.py
```python
TELEGRAM_BOT_TOKEN        # –ò–∑ .env
CARDS_FILE = "data/cards.json"
MIN_PLAYERS = 3           # –ú–∏–Ω–∏–º—É–º –∏–≥—Ä–æ–∫–æ–≤
MAX_PLAYERS = 10          # –ú–∞–∫—Å–∏–º—É–º –∏–≥—Ä–æ–∫–æ–≤
LOG_LEVEL = 'INFO'
```

---

## üîÑ –ü–æ–ª–Ω—ã–π Flow –∏–≥—Ä—ã

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /start
   ‚îî‚îÄ> start_handler.start_command()
       ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å"

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
   ‚îî‚îÄ> game_mode_handler.game_mode_callback()
       ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º"

3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º"
   ‚îî‚îÄ> game_mode_handler.mode_standard_callback()
       ‚îî‚îÄ> –°–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é (selected_mode = STANDARD)
       ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "–í—ã–±–µ—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤"

4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, "4 –∏–≥—Ä–æ–∫–æ–≤"
   ‚îî‚îÄ> game_handler.player_count_callback("players_4")
       ‚îú‚îÄ> game_manager.create_game(4)
       ‚îÇ   ‚îî‚îÄ> –°–æ–∑–¥–∞—ë—Ç 4 –ø—É—Å—Ç—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
       ‚îÇ
       ‚îú‚îÄ> game_manager.assign_roles_and_card()
       ‚îÇ   ‚îú‚îÄ> RoleDistributor.distribute_roles()
       ‚îÇ   ‚îÇ   ‚îî‚îÄ> 1 —Å–ª—É—á–∞–π–Ω—ã–π –∏–≥—Ä–æ–∫ = SPY
       ‚îÇ   ‚îÇ   ‚îî‚îÄ> 3 –∏–≥—Ä–æ–∫–∞ = CITIZEN
       ‚îÇ   ‚îî‚îÄ> CardLoader.get_random_card()
       ‚îÇ       ‚îî‚îÄ> –í—ã–±–∏—Ä–∞–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, "–í–∞—Ä–≤–∞—Ä—ã"
       ‚îÇ
       ‚îú‚îÄ> send_private_messages()
       ‚îÇ   ‚îú‚îÄ> –®–ø–∏–æ–Ω—É (–ò–≥—Ä–æ–∫ 2): "üïµÔ∏è –¢—ã —à–ø–∏–æ–Ω!"
       ‚îÇ   ‚îî‚îÄ> –ì—Ä–∞–∂–¥–∞–Ω–∞–º (1,3,4): 
       ‚îÇ       "üó∫Ô∏è –ö–∞—Ä—Ç–∞: –í–∞—Ä–≤–∞—Ä—ã"
       ‚îÇ       [—Ñ–æ—Ç–æ –∫–∞—Ä—Ç—ã]
       ‚îÇ
       ‚îî‚îÄ> –í —á–∞—Ç–µ: "üéÆ –ò–≥—Ä—É –Ω–∞—á–∏–Ω–∞–µ—Ç: –ò–≥—Ä–æ–∫ 2"

5. –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!
```

---

## üìä –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–±—ä–µ–∫—Ç–æ–≤

### Game
- **–°–æ–∑–¥–∞–Ω–∏–µ:** `game_manager.create_game()`
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** `game_manager.assign_roles_and_card()`
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:** `game_manager.games[game_id]`
- **–£–¥–∞–ª–µ–Ω–∏–µ:** `game_manager.delete_game()` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### UserSession
- **–°–æ–∑–¥–∞–Ω–∏–µ:** `game_storage.get_session(user_id)`
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–±–æ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–£–¥–∞–ª–µ–Ω–∏–µ:** `game_storage.delete_session()` –ø–æ—Å–ª–µ –∏–≥—Ä—ã

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

1. **–¢–æ–∫–µ–Ω –±–æ—Ç–∞** ‚Üí —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env` (–Ω–µ –≤ –∫–æ–¥–µ)
2. **–ö–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É** ‚Üí –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (Telegram –¥–µ—à–∏—Ñ—Ä—É–µ—Ç)
3. **–®–ø–∏–æ–Ω** ‚Üí –Ω–µ –≤–∏–¥–∏—Ç –∫–∞—Ä—Ç—É
4. **–ì—Ä–∞–∂–¥–∞–Ω–µ** ‚Üí –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∫–∞—Ä—Ç—É (–Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞)

---

## üöÄ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ–∂–∏–º –∏–≥—Ä—ã
1. –î–æ–±–∞–≤–∏—Ç—å `GameMode.NEW_MODE`
2. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ `RoleDistributor.distribute_roles()`
3. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ `keyboards/inline_keyboards.py`
4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `handlers/game_mode_handler.py`
5. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `main.py`

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É
1. –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `handlers/new_handler.py`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ `main.py`
3. –î–æ–±–∞–≤–∏—Ç—å `app.add_handler(CommandHandler("cmd", handler))`

### –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.sleep()` –∏–ª–∏ `APScheduler`
2. –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ `game.game_id`
3. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —á–∞—Ç

### –î–æ–±–∞–≤–∏—Ç—å –ë–î
1. –°–æ–∑–¥–∞—Ç—å `storage/database.py` —Å SQLAlchemy
2. –ó–∞–º–µ–Ω–∏—Ç—å `GameStorage` –Ω–∞ `DatabaseStorage`
3. –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç:** –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- **–ò–≥—Ä—ã –≤ –ø–∞–º—è—Ç–∏:** –ú–æ–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–≥—Ä
- **–°–µ—Å—Å–∏–∏ –≤ –ø–∞–º—è—Ç–∏:** –£–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ Redis/–ë–î

---

## üìù –ö–æ–¥ –ø—Ä–∏–º–µ—Ä—ã

### –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```python
session = game_storage.get_session(user_id)
if session.game_id:
    game = game_manager.get_game(session.game_id)
```

### –ü–æ–ª—É—á–∏—Ç—å —à–ø–∏–æ–Ω–∞
```python
spy = game.get_spy()
if spy:
    print(f"–®–ø–∏–æ–Ω: –ò–≥—Ä–æ–∫ #{spy.player_id}")
```

### –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
```python
await context.bot.send_message(
    chat_id=game.chat_id,
    text=f"–ò–≥—Ä—É –Ω–∞—á–∏–Ω–∞–µ—Ç: –ò–≥—Ä–æ–∫ #{game.get_start_player().player_id}"
)
```

---

**–ì–æ—Ç–æ–≤–æ! –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞.** üéâ
